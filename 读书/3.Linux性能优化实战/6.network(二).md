# DNS(似懂非懂)[^1]

DNS 服务通过资源记录的方式，来管理所有数据，它支持一下类型的记录

- A、AAAA:  IP address

  > ![image-20200703134348861](http://picgo.vipkk.work/20200703134355.png)

- MX : smtp mail exchangers。 邮件中转（？）

- NS: name server. 记录域名对应的ip地址

- PTR: pointer for reverse dns lookup。域名反向解析

  > 为了安全，验证请求人的ip

- cname: domain name aliases。域名的别名



## DNS解析流程

> 以下过程摘自趣谈网络协议[^2]

1. 电脑客户端会发出一个 DNS 请求，问 www.163.com 的 IP 是啥啊，并发给本地域名服务器 (本地 DNS)。那本地域名服务器 (本地 DNS) 是什么呢？如果是通过 DHCP 配置，本地 DNS 由你的网络服务商（ISP），如电信、移动等自动分配，它通常就在你网络服务商的某个机房。
2. 本地 DNS 收到来自客户端的请求。你可以想象这台服务器上缓存了一张域名与之对应 IP 地址的大表格。如果能找到 www.163.com，它就直接返回 IP 地址。如果没有，本地 DNS 会去问它的根域名服务器：“老大，能告诉我 www.163.com 的 IP 地址吗？”根域名服务器是最高层次的，全球共有 13 套。它不直接用于域名解析，但能指明一条道路。
3. 根 DNS 收到来自本地 DNS 的请求，发现后缀是 .com，说：“哦，www.163.com 啊，这个域名是由.com 区域管理，我给你它的顶级域名服务器的地址，你去问问它吧。”
4. 本地 DNS 转向问顶级域名服务器：“老二，你能告诉我 www.163.com 的 IP 地址吗？”顶级域名服务器就是大名鼎鼎的比如 .com、.net、 .org 这些一级域名，它负责管理二级域名，比如 163.com，所以它能提供一条更清晰的方向。
5. 顶级域名服务器说：“我给你负责 www.163.com 区域的权威 DNS 服务器的地址，你去问它应该能问到。”
6. 本地 DNS 转向问权威 DNS 服务器：“您好，www.163.com 对应的 IP 是啥呀？”163.com 的权威 DNS 服务器，它是域名解析结果的原出处。为啥叫权威呢？就是我的域名我做主。
7. 权威 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。
8. 本地 DNS 再将 IP 地址返回客户端，客户端和目标建立连接。

<img src="http://picgo.vipkk.work/20200703204157.jpg" alt="img" style="zoom:50%;" />



dig查找dns过程

<img src="http://picgo.vipkk.work/20200703205108.png" alt="image-20200703205108622" style="zoom:50%;" />





> DNS全局负载均衡: GSLB







## dig问题

1. https://stackoverflow.com/questions/53688690/dig-trace-does-not-do-a-trace



# 网络流量分析

## tcpdump

> 这个是个比较实用的工具，可以结合wireshare使用

命令list 

>  tcpdump -nn udp port 53 or host 35.190.27.188

![img](http://picgo.vipkk.work/20200703222331.png)



![img](http://picgo.vipkk.work/20200703222339.png)



## wireshark

菜单栏中，点击 Statistics -> Flow Graph, 可以看到流分析

















































[^1]: https://en.wikipedia.org/wiki/Domain_Name_System
[^2]: 摘自： https://time.geekbang.org/column/article/9895